{% extends "layout.html" %}

{% block body %}

<div class="container">
    <div class="header">
        <h1>CHATBOX &#128172</h1>
    </div>
    {% if session.user_id %}

    <script tpye="text/javascript">

        $(document).ready(function () {
            //load chatbox
            $("#chatbox").load("/chatbox");
            //scroll to the end of chatbox
            $('#chatbox').animate({ scrollTop: 1000000 }, 800);
            console.log($("chatbox").scrollTop())
            setInterval(function () {
                //check the hegiht of the chatbox
                var oldsh = $("#chatbox")[0].scrollHeight;
                //reaload chatbox
                $("#chatbox").load("/chatbox", function () {
                    var newsh = $("#chatbox")[0].scrollHeight;
                    //if there are any new messagess scroll to the end of the chat
                    if (newsh > oldsh)
                        $('#chatbox').animate({ scrollTop: 1000000 }, 800);
                });
            }, 5000);
        });



    </script>
    <div class="main ">
        You are login as: <h2>{{ session.username }}</h2> <a href="/logout">logout</a>
    </div>

    <div id="chatbox" class="chatbox">
    </div>

    <div class="footer">
        <form action="/send" method="post">

            <input type="text" name="message" autocomplete="off" autofocus>
            <button type="submit" value="send">SEND</button>
        </form>
    </div>
    {% else %}

    Please log in. <a href="/login">login</a>

    {% endif %}
</div>

{% endblock %}